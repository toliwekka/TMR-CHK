<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>T|Check Survey</title>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet" />
        <!-- Font Awesome -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />

        <style>
            :root {
                --primary: #2ecc71;
                --primary-light: #3ae074;
                --primary-dark: #1e8e4e;
                --secondary: #a3e4d7;
                --secondary-light: #b9f6e3;
                --secondary-dark: #7acfa6;
                --bg: #edf8f6;
                --card-bg: #f8fdfa;
                --text-color: #145a32;
                --accent-1: #b8e6d4;
                --accent-2: #cceee3;
                --accent-3: #dfeff0;
                --hover-bg: #d4f0e4;
                --hover-text: #0e3d24;
                --section-bg: #ffffff;
                --section-border: #ddd;
                --mini-card-bg: #f0f9f0;
                --mini-card-border: #cce6cc;
                --mini-card-hover: #d1e7d1;
                --button-bg: #2ecc71;
                --button-hover-bg: #28a745;
                --gradient: linear-gradient(135deg, var(--accent-2), var(--accent-1));
                --glass: rgba(255, 255, 255, 0.3);
                --text-dark: var(--text-color);
                --text-light: #fff;
                --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
                --accent: var(--primary);
            }

            body {
                margin: 0;
                font-family: "Poppins", sans-serif;
                background: var(--bg);
                color: var(--text-color);
                padding: 2rem 1rem;
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
                position: relative;
            }

            .theme-switcher {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
            }

            .form-select {
                padding: 0.5rem 1rem;
                border-radius: 8px;
                border: none;
                background: var(--card-bg);
                color: var(--text-color);
                font-weight: 600;
                box-shadow: var(--shadow);
            }

            .survey-container {
                max-width: 800px;
                width: 100%;
                background: var(--card-bg);
                border-radius: 20px;
                backdrop-filter: blur(20px);
                box-shadow: var(--shadow);
                padding: 2rem;
                text-align: center;
            }

            .flip-badge {
                width: 60px;
                height: 60px;
                background: var(--primary);
                color: white;
                border-radius: 50%;
                font-weight: bold;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.3rem;
                margin: 0 auto 1.5rem;
                box-shadow: var(--shadow);
                animation: popIn 0.4s ease-in-out;
            }

            .survey-card {
                background: rgba(255, 255, 255, 0.25);
                padding: 2rem;
                border-radius: 16px;
                box-shadow: var(--shadow);
                margin-bottom: 2rem;
            }

            .question-intro {
                font-size: 1.2rem;
                font-weight: 600;
                color: var(--primary-dark);
                margin-bottom: 0.25rem;
            }

            .question-context {
                font-size: 0.95rem;
                opacity: 0.7;
                margin-bottom: 1rem;
            }

            .question-text {
                font-size: 1.6rem;
                font-weight: bold;
                color: var(--text-color);
            }

            .option-card {
                background: rgba(255, 255, 255, 0.2);
                border-radius: 12px;
                padding: 1.5rem 1rem;
                box-shadow: var(--shadow);
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 1rem;
            }

            .option {
                padding: 0.7rem 1.5rem;
                background: var(--primary-light);
                color: white;
                border: none;
                border-radius: 30px;
                font-weight: 600;
                cursor: pointer;
                transition: background 0.2s ease-in-out;
            }

            .option:hover {
                background: var(--primary-dark);
            }

            .option {
                padding: 0.7rem 1.5rem;
                background: var(--primary-light);
                color: var(--option-text-color, #ffffff); /* fallback to white */
                border: none;
                border-radius: 30px;
                font-weight: 700;
                font-size: 1rem;
                letter-spacing: 0.1px;
                cursor: pointer;
                box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2); /* subtle shadow for more visual lift */
                transition: background 0.2s ease-in-out, color 0.2s ease-in-out;
            }

            .option:hover {
                background: var(--primary-dark);
                color: var(--option-hover-text-color, #fff);
            }

            .next-button {
                display: block;
                margin: 2rem auto 0;
                background: var(--primary);
                color: white;
                padding: 0.9rem 2rem;
                border: none;
                border-radius: 30px;
                font-weight: 600;
                cursor: pointer;
                transition: transform 0.2s ease;
            }

            .next-button:hover {
                transform: scale(1.05);
            }

            @keyframes popIn {
                from {
                    transform: scale(0.8);
                    opacity: 0;
                }
                to {
                    transform: scale(1);
                    opacity: 1;
                }
            }

            .option.selected {
                background: var(--button-bg);
                color: #fff;
                transform: scale(1.05);
            }

            html,
            body {
                height: 100%;
                margin: 0;
                padding: 0;
                display: flex;
                flex-direction: column;
            }

            .page-wrapper {
                flex: 1;
            }

            .sticky-footer {
                background: rgba(0, 0, 0, 0.3);
                color: #fff;
                text-align: center;
                padding: 1rem 0;
                font-size: 0.9rem;
                backdrop-filter: blur(10px);
                width: 100%;
            }

            .sticky-footer a {
                color: #ffd3a5;
                text-decoration: none;
                margin: 0 0.5rem;
            }

            .sticky-footer a:hover {
                text-decoration: underline;
            }

            .continue-button {
                margin: 2rem auto 0;
                padding: 0.8rem 2rem;
                background: var(--primary);
                color: white;
                font-weight: 600;
                font-size: 1rem;
                border: none;
                border-radius: 30px;
                cursor: pointer;
                transition: background 0.3s ease;
                display: block;
                text-align: center;
            }

            .continue-button:hover {
                background: var(--button-hover-bg);
            }

            .option-card {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 1rem;
                margin-top: 2rem;
            }

            .option {
                background: var(--primary-light);
                color: var(--option-text-color, #fff);
                border: none;
                border-radius: 30px;
                font-weight: 600;
                padding: 0.7rem 1.5rem;
                font-size: 1rem;
                cursor: pointer;
                box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
                transition: background 0.2s ease-in-out;
                max-width: 100%;
                white-space: normal;
                text-align: center;
                line-height: 1.4;
            }

            /* Automatically make longer options full width */
            .option.long-option {
                flex: 1 1 100%;
            }

            /* Optional: better layout for small screens */
            @media (max-width: 576px) {
                .option {
                    flex: 1 1 100%;
                }
            }

            .option-cards-wrapper {
                display: flex;
                flex-direction: column;
                gap: 2rem;
                width: 100%;
            }

            .option-card-group {
                background: var(--card-bg);
                border-radius: 16px;
                padding: 1.5rem;
                box-shadow: var(--shadow);
                display: flex;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap;
                gap: 1rem;
            }

            .card-1 .option {
                flex: 1 1 100%;
                text-align: center;
            }

            .card-2 {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 1rem;
            }

            .card-3 .option {
                flex: 1 1 100%;
                text-align: center;
            }

            .option {
                padding: 0.7rem 1.5rem;
                background: var(--primary-light);
                color: var(--option-text-color, #fff);
                border: none;
                border-radius: 30px;
                font-weight: 600;
                font-size: 1rem;
                cursor: pointer;
                transition: background 0.2s ease-in-out;
                white-space: normal;
                text-align: center;
                line-height: 1.4;
            }

            .option:hover {
                background: var(--primary-dark);
            }

            .option.selected {
                background-color: var(--primary-dark);
                color: #fff;
            }
            .option.disabled {
                opacity: 0.5;
                pointer-events: none;
            }
        </style>
        <style>
            .fade-in {
                opacity: 0;
                transition: opacity 1s ease;
            }

            .fade-in.show {
                opacity: 1;
            }
        </style>
    </head>
    <body>
        <!-- Main content area -->
        <div class="page-wrapper">
            <!-- Theme switcher -->
            <div class="theme-switcher">
            <select id="themeSelect" class="form-select">
                <option value="default" selected>TMR Fresh</option>
                <option value="fieryRed">ðŸ”¥ Fiery Red</option>
                <option value="blushRose">ðŸŒ¸ Blush Rose</option>
                <option value="midnightDark">ðŸŒš Midnight Dark</option>
                <option value="sereneLavender">ðŸ’œ Serene Lavender</option>
                <option value="oceanBreeze">ðŸŒŠ Ocean Breeze</option>
                <option value="goldenSunset">ðŸŒ… Golden Sunset</option>
                <option value="softStone">ðŸª¶ Soft Stone</option>
                <option value="softBlush">ðŸ’– Soft Blush</option>
            </select>
        </div>
            </div>

            <div id="chkpt" class="survey-container">
                <h1 class="text-center mb-4" style="color: var(--primary); font-weight: 700;">
                    Begin Your T|Check Self-Discovery Journey
                </h1>

                <div class="flip-badge" id="questionBadge">1</div>

                <div class="survey-card">
                    <h3 class="question-intro" id="questionSection">Section A</h3>
                    <p class="question-context" id="questionMeta">During the past 14 days</p>
                    <p class="question-text" id="questionText">Iâ€™ve been feeling optimistic about the future.</p>
                </div>

                <div class="option-card" id="optionsContainer">
                    <!-- Options injected -->
                </div>
                <button id="continueBtn" class="continue-button" style="display: none;">
                    Continue
                </button>

                <!-- Serene Lavender Consent Button -->
                <button id="chk-header" class="chk-accordion serene-theme" type="button" style="display: none;">
                    <div class="chk-icon">
                        <i class="bi bi-bar-chart-line"></i>
                    </div>
                    <div class="chk-content">
                        <h3 class="chk-title">Step 3: Your Personal Insights</h3>
                        <p class="chk-description"></p>
                    </div>
                </button>

                <style>
                    .chk-accordion.serene-theme {
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        width: 100%;
                        text-align: center;
                        background: #27ef96;
                        border: none;
                        border-radius: 14px;
                        padding: 1.5rem 1rem;
                        cursor: pointer;
                        margin-top: 10px;
                        transition: background-color 0.3s ease, opacity 0.3s ease;
                        box-shadow: 0 8px 16px rgba(155, 89, 182, 0.15);
                        font-family: "Poppins", sans-serif;
                    }

                    .chk-accordion.serene-theme:hover:not(:disabled) {
                        background-color: #d6fff1;
                    }

                    .chk-accordion:disabled {
                        opacity: 0.5;
                        cursor: not-allowed;
                        pointer-events: none;
                    }

                    .chk-icon {
                        font-size: 2.2rem;
                        color: var(--primary-dark, #7a478d);
                        margin-bottom: 0.75rem;
                    }

                    .chk-title {
                        font-size: 1.3rem;
                        font-weight: 600;
                        margin: 0.25rem 0;
                        color: var(--text-color, #311d53);
                    }

                    .chk-description {
                        font-size: 0.95rem;
                        color: #5d3d73;
                        margin: 0.25rem 0 0.5rem;
                    }

                    .consent-label {
                        font-size: 0.85rem;
                        font-weight: 500;
                        background: #d6fff1;
                        color: #fff;
                        padding: 0.4rem 0.8rem;
                        border-radius: 6px;
                        display: inline-block;
                        margin-top: 0.3rem;
                    }
                </style>
            </div>

            <!-- FULLSCREEN IFRAME -->
            <div id="iframeContainer" class="fullscreen-iframe">
                <iframe id="assessmentIframe" src="" allowfullscreen></iframe>
            </div>
        </div>
        <!-- Footer (sticks to bottom when content is short) -->
        <footer class="sticky-footer">
            <p>
                &copy; NFT Consult | Powered by Toli Wekka. All rights reserved. |
                <a href="#">Privacy</a>
                |
                <a href="#">Terms</a>
            </p>
        </footer>

        <!-- STYLES -->
        <style>
            .hero-description {
                font-size: 1.5rem;
                font-weight: 700;
                color: #fff;
                background-color: var(--primary-dark, #5a0c0c);
                padding: 1.2rem 1.5rem;
                border-radius: 12px;
                box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
                max-width: 100vw;
                margin: 2rem auto;
                text-align: center;
                line-height: 1.6;
                letter-spacing: 0.4px;
                transition: background-color 0.3s ease, color 0.3s ease;
            }

            .fullscreen-iframe {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                display: none;
                background: var(--bg, #f5fdf7);
                z-index: 9999;
            }

            .fullscreen-iframe iframe {
                width: 100%;
                height: 100%;
                border: none;
            }

            .close-btn {
                position: absolute;
                top: 20px;
                right: 30px;
                background: var(--primary, #930d0e);
                color: #fff;
                border: none;
                padding: 10px 18px;
                font-size: 1rem;
                border-radius: 8px;
                cursor: pointer;
                z-index: 10000;
            }
        </style>

        <!-- SCRIPT -->
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const btn = document.getElementById("chk-header");

                btn.addEventListener("click", () => {
                    // Redirect the full page to report.html
                    window.location.href = "report.html";
                });
            });

            const themes = {
                default: {
        "--primary": "#003366",
        "--primary-light": "#00509e",
        "--primary-dark": "#001f4d",
        "--secondary": "#5ac8fa",
        "--secondary-light": "#a3e4f7",
        "--secondary-dark": "#0077b6",
        "--bg": "#f4f6f8",
        "--card-bg": "#ffffff",
        "--text-color": "#ffffff",
        "--accent-1": "#00bfff",
        "--accent-2": "#e0f7fa",
        "--accent-3": "#dde2e8",
        "--hover-bg": "#001f4d",
        "--hover-text": "#ffffff",
        "--section-bg": "#ffffff",
        "--section-border": "#ccc",
        "--mini-card-bg": "#e6f0fa",
        "--mini-card-border": "#b0c4de",
        "--mini-card-hover": "#cce6ff",
        "--button-bg": "#003366",
        "--button-hover-bg": "#00509e"
                },

                fieryRed: {
                    "--primary": "#930d0e",
                    "--primary-light": "#c22c2c",
                    "--primary-dark": "#7b0a0b",
                    "--secondary": "#2a7a4e",
                    "--secondary-light": "#66b59b",
                    "--secondary-dark": "#1e5c3f",
                    "--bg": "#f5fdf7",
                    "--card-bg": "#ffffff",
                    "--text-color": "#333",
                    "--accent-1": "#f9d5d4",
                    "--accent-2": "#e4b0b1",
                    "--accent-3": "#f1c0c1",
                    "--hover-bg": "#d46a6a",
                    "--button-bg": "#930d0e",
                    "--button-hover-bg": "#b35c5c",
                },
                blushRose: {
                    "--primary": "#e84393",
                    "--primary-light": "#f56eb5",
                    "--primary-dark": "#b93372",
                    "--secondary": "#fab1a0",
                    "--secondary-light": "#ffcfb8",
                    "--secondary-dark": "#f28f75",
                    "--bg": "#fceff9",
                    "--card-bg": "#fff",
                    "--text-color": "#6c2c5b",
                    "--accent-1": "#ffe2e6",
                    "--accent-2": "#ffccd7",
                    "--accent-3": "#ffd0d8",
                    "--hover-bg": "#f3a8b7",
                    "--button-bg": "#e84393",
                    "--button-hover-bg": "#ec5987",
                },
                midnightDark: {
                    "--primary": "#ff5252",
                    "--primary-light": "#ff7f7f",
                    "--primary-dark": "#e10000",
                    "--secondary": "#00c896",
                    "--secondary-light": "#33e0b3",
                    "--secondary-dark": "#009c75",
                    "--bg": "#1a1a1a",
                    "--card-bg": "#2a2a2a",
                    "--text-color": "#eee",
                    "--accent-1": "#ff2d2d",
                    "--accent-2": "#ff4444",
                    "--accent-3": "#ff6b6b",
                    "--hover-bg": "#ff4d4d",
                    "--button-bg": "#ff5252",
                    "--button-hover-bg": "#ff4d4d",
                },
                sereneLavender: {
                    "--primary": "#9b59b6",
                    "--primary-light": "#ab70c6",
                    "--primary-dark": "#7a478d",
                    "--secondary": "#dcd6f7",
                    "--secondary-light": "#f1f0fe",
                    "--secondary-dark": "#a5a1d8",
                    "--bg": "#f6f0ff",
                    "--card-bg": "#ffffff",
                    "--text-color": "#4a347f",
                    "--hover-bg": "#ece3ff",
                    "--section-bg": "#f5f0ff",
                    "--section-border": "#d0a3db",
                    "--mini-card-bg": "#f3e6f9",
                    "--mini-card-border": "#d4aee0",
                    "--mini-card-hover": "#d8b7e4",
                    "--button-bg": "#9b59b6",
                    "--button-hover-bg": "#7a478d",
                },
                oceanBreeze: {
                    "--primary": "#0077b6",
                    "--primary-light": "#66a6c9",
                    "--primary-dark": "#004f74",
                    "--secondary": "#90e0ef",
                    "--secondary-light": "#b8efff",
                    "--secondary-dark": "#60b6c8",
                    "--bg": "#e0f7fa",
                    "--card-bg": "#ffffff",
                    "--text-color": "#003b5c",
                    "--hover-bg": "#caf0f8",
                    "--section-bg": "#d4eaff",
                    "--section-border": "#5bb8d1",
                    "--mini-card-bg": "#b3e2f2",
                    "--mini-card-border": "#7fb7cf",
                    "--mini-card-hover": "#a1d2e6",
                    "--button-bg": "#0077b6",
                    "--button-hover-bg": "#005f86",
                },
                goldenSunset: {
                    "--primary": "#ff6b6b",
                    "--primary-light": "#ff9999",
                    "--primary-dark": "#d94d4d",
                    "--secondary": "#ffa502",
                    "--secondary-light": "#ffbf6e",
                    "--secondary-dark": "#d57f00",
                    "--bg": "#fffaf0",
                    "--card-bg": "#fff6f0",
                    "--text-color": "#4e342e",
                    "--hover-bg": "#ffe9d6",
                    "--section-bg": "#fff3e6",
                    "--section-border": "#ffcc99",
                    "--mini-card-bg": "#f9e6e1",
                    "--mini-card-border": "#f5c5b0",
                    "--mini-card-hover": "#f8d1b6",
                    "--button-bg": "#ff6b6b",
                    "--button-hover-bg": "#ff4444",
                },
                softStone: {
                    "--primary": "#7f8c8d",
                    "--primary-light": "#a4b0b1",
                    "--primary-dark": "#5f6a6a",
                    "--secondary": "#bdc3c7",
                    "--secondary-light": "#d0d6d7",
                    "--secondary-dark": "#98a1a2",
                    "--bg": "#f2f4f4",
                    "--card-bg": "#ffffff",
                    "--text-color": "#2c3e50",
                    "--hover-bg": "#e5e8e8",
                    "--section-bg": "#d9e0e3",
                    "--section-border": "#b7c1c4",
                    "--mini-card-bg": "#d9e0e3",
                    "--mini-card-border": "#c1c8c9",
                    "--mini-card-hover": "#c8d1d2",
                    "--button-bg": "#7f8c8d",
                    "--button-hover-bg": "#5e6b6c",
                },
                softBlush: {
                    "--primary": "#ff9aa2",
                    "--primary-light": "#ffb6c1",
                    "--primary-dark": "#e27a82",
                    "--secondary": "#ffd3b6",
                    "--secondary-light": "#fff2d9",
                    "--secondary-dark": "#f8c19f",
                    "--bg": "#fff5f8",
                    "--card-bg": "#ffffff",
                    "--text-color": "#b33951",
                    "--hover-bg": "#ffe9ef",
                    "--section-bg": "#ffe3ea",
                    "--section-border": "#fbc9d0",
                    "--mini-card-bg": "#ffe8ec",
                    "--mini-card-border": "#f5ccd3",
                    "--mini-card-hover": "#ffdce3",
                    "--button-bg": "#ff9aa2",
                    "--button-hover-bg": "#e27a82",
                },
            };

            const questions = [
                {
                    id: 1,
                    section: "Life Satisfaction and Life Evaluation",
                    pastcoupledays: "",
                    text:
                        "Please imagine a ladder with steps numbered from zero at the bottom to ten at the top. The top of the ladder represents the best possible life for you, and the bottom of the ladder represents the worst possible life for you. On which step of the ladder would you say you personally feel you stand at this time?",
                    answerType: "Worst-Best",
                },
                { id: 2, section: "Life Satisfaction and Life Evaluation", pastcoupledays: "", text: "On which step do you think you will stand about five years from now?", answerType: "Worst-Best" },
                { id: 3, section: "Life Satisfaction and Life Evaluation", pastcoupledays: "", text: "Overall, how satisfied are you with life as a whole these days?", answerType: "Satisfaction" },
                { id: 4, section: "Physical Health, Mental Health, and Physical Function", pastcoupledays: "", text: "In general, how would you rate your physical health?", answerType: "Health" },
                { id: 5, section: "Physical Health, Mental Health, and Physical Function", pastcoupledays: "", text: "How would you rate your overall mental health?", answerType: "Health" },
                {
                    id: 6,
                    section: "Physical Health, Mental Health, and Physical Function",
                    pastcoupledays: "",
                    text: "For at least the past 6 months, to what extent have you been limited because of a health problem in activities people usually do?",
                    answerType: "Limitation",
                },
                { id: 7, section: "Meaning and Purpose", pastcoupledays: "", text: "Overall, to what extent do you feel the things you do in your life are worthwhile?", answerType: "Worthwhile" },
                { id: 8, section: "Meaning and Purpose", pastcoupledays: "", text: "I understand my purpose in life.", answerType: "Agreement" },
                { id: 9, section: "Meaning and Purpose", pastcoupledays: "", text: "I have a sense of direction and purpose in life.", answerType: "Agreement" },
                { id: 10, section: "Character and Caring", pastcoupledays: "", text: "I always act to promote good in all circumstances, even in difficult and challenging situations.", answerType: "TrueOfMe" },
                { id: 11, section: "Character and Caring", pastcoupledays: "", text: "Iâ€™m always able to give up some happiness now for greater happiness later.", answerType: "TrueOfMe" },
                { id: 12, section: "Character and Caring", pastcoupledays: "", text: "How often do you show someone in your community that you love or care for them?", answerType: "Frequency" },
                { id: 13, section: "Relationships", pastcoupledays: "", text: "I am content with my friendships and relationships.", answerType: "Agreement" },
                { id: 14, section: "Relationships", pastcoupledays: "", text: "My relationships are as satisfying as I would want them to be.", answerType: "Agreement" },
                { id: 15, section: "Relationships", pastcoupledays: "", text: "How often do you feel lonely?", answerType: "Loneliness" },
                { id: 16, section: "Community and Social Support", pastcoupledays: "", text: "How would you describe your sense of belonging to your local community?", answerType: "Community" },
                { id: 17, section: "Community and Social Support", pastcoupledays: "", text: "If you were in trouble, do you have relatives or friends you can count on to help you whenever you need them, or not?", answerType: "Frequency" },
                { id: 18, section: "Community and Social Support", pastcoupledays: "", text: "Are you satisfied or dissatisfied with the city or area where you live?", answerType: "Satisfaction" },
                { id: 19, section: "Financial Evaluation and Stability", pastcoupledays: "", text: "How often do you worry about being able to meet normal monthly living expenses?", answerType: "WorryAboutLivingExpenses" },
                { id: 20, section: "Financial Evaluation and Stability", pastcoupledays: "", text: "How often do you worry about safety, food, or housing?", answerType: "WorrySafety" },
                {
                    id: 21,
                    section: "Financial Evaluation and Stability",
                    pastcoupledays: "",
                    text:
                        "Please imagine the top of the ladder represents the best possible financial situation for you, and the bottom of the ladder represents the worst possible financial situation for you. Please indicate where on the ladder you stand right now.",
                    answerType: "Worst-Best",
                },
                { id: 22, section: "Affect", pastcoupledays: "", text: "In general, how happy or unhappy do you usually feel?", answerType: "Happiness" },
                { id: 23, section: "Affect", pastcoupledays: "", text: "During the past two weeks, how often have you experienced positive emotions such as joy, affection, or hope?", answerType: "Frequency" },
                { id: 24, section: "Affect", pastcoupledays: "", text: "During the past two weeks, how often have you experienced negative emotions such as sadness, worry, or despair?", answerType: "Frequency" },
            ];

            const answerSetsII = {
                MentalWellBeing: ["None of the time", "Rarely", "Some of the time", "Often", "All of the time"],
                Satisfaction: ["Very dissatisfied", "Dissatisfied", "Neutral", "Satisfied", "Very satisfied"],
            };

            const answerSets = {
                "Worst-Best": ["0 = Worst Possible", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Best Possible"],
                Satisfaction: ["0 = Not Satisfied at All", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Completely Satisfied"],
                Health: ["0 = Poor", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Perfect Health"],
                Limitation: ["0 = Severely Limited", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Not Limited at All"],
                Worthwhile: ["0 = Not at All Worthwhile", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Completely Worthwhile"],
                Agreement: ["0 = Strongly Disagree", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Strongly Agree"],
                TrueOfMe: ["0 = Not True of Me", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Completely True of Me"],
                Frequency: ["0 = Never", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = All of the Time"],
                Happiness: ["0 = Extremely Unhappy", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Extremely Happy"],
                MentalWellBeing: ["0 = Not at All", "Rarely", "Some of the Time", "Often", "All the Time"],
                Community: ["0 = Very Weak", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Extremely Strong"],
                Loneliness: ["0 = Always", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Never"],
                SatisfactionWithCity: ["0 = Completely Dissatisfied", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Completely Satisfied"],
                WorrySafety: ["0 = Worry All of the Time", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Do Not Ever Worry"],
                WorryAboutLivingExpenses: ["0 = Worry All of the Time", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Do Not Ever Worry"],
            };

            let currentIndex = 0;

            function applyTheme(themeName) {
                const theme = themes[themeName];
                Object.entries(theme).forEach(([key, val]) => {
                    document.documentElement.style.setProperty(key, val);
                });
                localStorage.setItem("theme", themeName);
            }


            let scoreTotal = 0;
            const userResponses = {}; // Stores numeric score per question
            const userAnswers = {}; // Stores question and answer text

            function renderQuestion(index) {
                const q = questions[index];
                document.getElementById("questionSection").textContent = q.section;
                document.getElementById("questionMeta").textContent = q.pastcoupledays;
                document.getElementById("questionText").textContent = q.text;
                document.getElementById("questionBadge").textContent = index + 1;

                const optionsContainer = document.getElementById("optionsContainer");
                optionsContainer.innerHTML = "";

                (answerSets[q.answerType] || []).forEach((opt) => {
                    const btn = document.createElement("button");
                    btn.className = "option";
                    btn.textContent = opt;

                    if (opt.length > 6) btn.classList.add("long-option");

                    btn.addEventListener("click", () => {
                        // Clear previous selection visuals
                        const allButtons = optionsContainer.querySelectorAll(".option");
                        allButtons.forEach((b) => b.classList.remove("selected"));
                        btn.classList.add("selected");

                        // Extract score
                        let score = 0;
                        const match = opt.match(/^(\d+)\s*=?/); // e.g., "3 = Sometimes"
                        if (match) {
                            score = parseInt(match[1]);
                        } else if (!isNaN(opt)) {
                            score = parseInt(opt);
                        }

                        // Adjust total if user changed answer
                        if (userResponses[index] !== undefined) {
                            scoreTotal -= userResponses[index];
                        }
                        userResponses[index] = score;
                        scoreTotal += score;

                        // Save question and selected answer
                        userAnswers[index] = {
                            question: q.text,
                            answer: opt,
                        };

                        // Save to localStorage
                        localStorage.setItem("BScore", scoreTotal);
                        localStorage.setItem("BAnswers", JSON.stringify(userAnswers));

                        // Continue or disable on final question
                        setTimeout(() => {
                            if (index === questions.length - 1) {
                                document.getElementById("chk-header").style.display = "block";
                                console.log("âœ… Final Score:", scoreTotal);

                                // âŒ Disable all buttons after last question is answered
                                const allButtons = optionsContainer.querySelectorAll(".option");
                                allButtons.forEach((b) => {
                                    b.disabled = true;
                                    b.classList.add("disabled"); // Optional: add class for styling
                                });
                            } else {
                                currentIndex++;
                                renderQuestion(currentIndex);
                            }
                        }, 200);
                    });

                    optionsContainer.appendChild(btn);
                });
            }


            // Initialize and apply theme as early as possible
            let currentTheme = localStorage.getItem("theme") || "default";
            applyTheme(currentTheme);

            // Theme selection dropdown
            document.addEventListener("DOMContentLoaded", () => {
                const themeSelect = document.getElementById("themeSelect");
                if (themeSelect) {
                    themeSelect.value = currentTheme;
                    themeSelect.addEventListener("change", (e) => {
                        applyTheme(e.target.value);
                    });
                }

                // Render initial question
                renderQuestion(currentIndex);

                // Re-broadcast theme for late-loading iframes
                setTimeout(() => {
                    broadcastThemeToIframes(currentTheme);
                }, 500);
            });

            // Apply the selected theme
            function applyTheme(themeName) {
                const theme = themes[themeName];
                if (!theme) return;

                // Apply CSS variables
                Object.entries(theme).forEach(([key, value]) => {
                    document.documentElement.style.setProperty(key, value);
                });

                // Adjust text color for readability
                setHeroDescriptionTextColor();

                // Persist and sync
                localStorage.setItem("theme", themeName);
                currentTheme = themeName;
                broadcastThemeToIframes(themeName);
            }

            // Send theme to all iframes
            function broadcastThemeToIframes(themeName) {
                document.querySelectorAll("iframe").forEach((iframe) => {
                    iframe.contentWindow?.postMessage({ theme: themeName }, "*");
                });
            }

            // Adjust text color based on theme background
            function setHeroDescriptionTextColor() {
                const bg = getComputedCSSVar("--primary-dark");
                if (!bg || !bg.startsWith("#")) return;
                const luminance = getLuminance(bg);
                const color = luminance > 0.5 ? "#111" : "#fff";
                const heroDesc = document.querySelector(".hero-description");
                if (heroDesc) heroDesc.style.color = color;
            }

            // Get CSS variable value
            function getComputedCSSVar(variable) {
                return getComputedStyle(document.documentElement).getPropertyValue(variable).trim();
            }

            // Calculate luminance for color contrast
            function getLuminance(hex) {
                const rgb = hex
                    .replace("#", "")
                    .match(/.{2}/g)
                    .map((x) => parseInt(x, 16) / 255);
                const lum = rgb.map((c) => (c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4)));
                return 0.2126 * lum[0] + 0.7152 * lum[1] + 0.0722 * lum[2];
            }

            // Listen for theme sync messages
            window.addEventListener("message", (event) => {
                if (event.data?.theme && themes[event.data.theme]) {
                    applyTheme(event.data.theme);
                    const themeSelect = document.getElementById("themeSelect");
                    if (themeSelect) themeSelect.value = event.data.theme;
                }
            });
        </script>
    </body>
</html>
